!function($){"use strict";var BootstrapTable,_init,_initToolbar,_initHeader,_initBody,_initSearch,sprintf=$.fn.bootstrapTable.utils.sprintf,objectKeys=$.fn.bootstrapTable.utils.objectKeys,getOptionsFromSelectControl=function(a){return window.__customControls___&&a.length>0?a.get(a.length-1).options:""},hideUnusedSelectOptions=function(a,b){var d,c=getOptionsFromSelectControl(a);for(d=0;d<c.length;d++)""!==c[d].value&&(b.hasOwnProperty(c[d].value)?a.find(sprintf("option[value='%s']",c[d].value)).show():a.find(sprintf("option[value='%s']",c[d].value)).hide())},addOptionToSelectControl=function(a,b,c){b=$.trim(b),a=$(a.get(a.length-1)),existOptionInSelectControl(a,b)||a.append($("<option></option>").attr("value",b).text($("<div />").html(c).text()))},sortSelectControl=function(a){var b=a.find("option:gt(0)");b.sort(function(a,b){return a=$(a).text().toLowerCase(),b=$(b).text().toLowerCase(),$.isNumeric(a)&&$.isNumeric(b)&&(a=parseFloat(a),b=parseFloat(b)),a>b?1:b>a?-1:0}),a.find("option:gt(0)").remove(),a.append(b)},existOptionInSelectControl=function(a,b){var d,c=getOptionsFromSelectControl(a);for(d=0;d<c.length;d++)if(c[d].value===b.toString())return!0;return!1},fixHeaderCSS=function(a){var b=hasBetweenDatepicker(a);window.__customControls___?b?a.$tableHeader.css("height","108px"):a.$tableHeader.css("height","77px"):a.$tableHeader.css("height","37px")},hasBetweenDatepicker=function(a){var d,b=!1,c=a.options.datepickerBetween;for(d in c)if(c[d].between){b=!0;break}return b},getCurrentHeader=function(a){var b=a.$header;return a.options.height&&(b=a.$tableHeader),b},getCurrentSearchControls=function(a){var b="select, input";return a.options.height&&(b="table select, table input, table .bootstrap-laydate"),b},getCursorPosition=function(a){var b,c,d;return $.fn.bootstrapTable.utils.isIEBrowser()?$(a).is("input")?(b=0,"selectionStart"in a?b=a.selectionStart:"selection"in document&&(a.focus(),c=document.selection.createRange(),d=document.selection.createRange().text.length,c.moveStart("character",-a.value.length),b=c.text.length-d),b):-1:-1},setCursorPosition=function(a,b){$.fn.bootstrapTable.utils.isIEBrowser()&&(void 0!==a.setSelectionRange?a.setSelectionRange(b,b):$(a).val(a.value))},copyValues=function(a){var b=getCurrentHeader(a),c=getCurrentSearchControls(a);a.options.valuesFilterControl=[],b.find(c).each(function(){a.options.valuesFilterControl.push({field:$(this).closest("[data-field]").data("field"),value:$(this).hasClass("bootstrap-laydate")?$(this).text():$(this).val(),position:getCursorPosition($(this).get(0))})})},setValues=function(a){var b=null,c=[],d=getCurrentHeader(a),e=getCurrentSearchControls(a);a.options.valuesFilterControl.length>0&&d.find(e).each(function(){b=$(this).closest("[data-field]").data("field"),c=$.grep(a.options.valuesFilterControl,function(a){return a.field===b}),c.length>0&&c.length<2?($(this).val(c[0].value),$(this).hasClass("bootstrap-laydate")&&$(this).text(c[0].value),setCursorPosition($(this).get(0),c[0].position)):$(this).hasClass("bootstrap-laydate")&&($(this).hasClass("date-filter-control-start")&&$(this).text(c[0].value),$(this).hasClass("date-filter-control-end")&&$(this).text(c[1].value))})},collectBootstrapCookies=function(){var a=[],b=document.cookie.match(/(?:bs.table.)(\w*)/g);return b?($.each(b,function(b,c){/./.test(c)&&(c=c.split(".").pop()),-1===$.inArray(c,a)&&a.push(c)}),a):void 0},initFilterSelectControls=function(a){var b=a.data,d=(a.pageTo<a.options.data.length?a.options.data.length:a.pageTo,function(a){return a.filterControl&&"select"===a.filterControl.toLowerCase()&&a.searchable}),e=function(a){return void 0===a.filterData||"column"===a.filterData.toLowerCase()},f=function(a){return a&&a.length>0},g=a.options.pagination?"server"===a.options.sidePagination?a.pageTo:a.options.totalRows:a.pageTo;$.each(a.header.fields,function(c,h){var k,l,m,n,o,i=a.columns[$.fn.bootstrapTable.utils.getFieldIndex(a.columns,h)],j=$(".bootstrap-table-filter-control-"+escapeID(i.field));if(d(i)&&e(i)&&f(j)){for(0===j.get(j.length-1).options.length&&addOptionToSelectControl(j,"",""),k={},l=0;g>l;l++)m=b[l][h],n=$.fn.bootstrapTable.utils.calculateObjectValue(a.header,a.header.formatters[c],[m,b[l],l],m),k[n]=m;for(o in k)addOptionToSelectControl(j,k[o],o);sortSelectControl(j),a.options.hideUnusedSelectOptions&&hideUnusedSelectOptions(j,k)}})},escapeID=function(a){return String(a).replace(/(:|\.|\[|\]|,)/g,"\\$1")},createControls=function(that,header){var addedFilterControl=!1,isVisible,html,timeoutId=0;$.each(that.columns,function(i,column){var nameControl,filterDataType,filterDataSource,selectControl,variableValues,key;if(isVisible="hidden",html=[],column.visible&&(column.filterControl&&window.__customControls___?(html.push('<div class="filter-control">'),nameControl=column.filterControl.toLowerCase(),column.searchable&&that.options.filterTemplate[nameControl]&&(addedFilterControl=!0,isVisible="visible",html.push(that.options.filterTemplate[nameControl](that,column.field,isVisible,column.filterControlPlaceholder)))):html.push('<div class="no-filter-control"></div>'),$.each(header.children().children(),function(a,b){return b=$(b),b.data("field")===column.field?(b.find(".fht-cell").append(html.join("")),!1):void 0}),void 0!==column.filterData&&"column"!==column.filterData.toLowerCase())){if(filterDataType=getFilterDataMethod(filterDataMethods,column.filterData.substring(0,column.filterData.indexOf(":"))),null===filterDataType)throw new SyntaxError('Error. You should use any of these allowed filter data methods: var, json, url. Use like this: var: {key: "value"}');switch(filterDataSource=column.filterData.substring(column.filterData.indexOf(":")+1,column.filterData.length),selectControl=$(".bootstrap-table-filter-control-"+escapeID(column.field)),addOptionToSelectControl(selectControl,"","请选择"),filterDataType(filterDataSource,selectControl),filterDataType){case"url":$.ajax({url:filterDataSource,dataType:"json",success:function(a){for(var b in a)addOptionToSelectControl(selectControl,b,a[b]);sortSelectControl(selectControl)}});break;case"var":variableValues=window[filterDataSource];for(key in variableValues)addOptionToSelectControl(selectControl,key,variableValues[key]);sortSelectControl(selectControl);break;case"jso":variableValues=eval("("+filterDataSource+")");for(key in variableValues)addOptionToSelectControl(selectControl,key,variableValues[key]);sortSelectControl(selectControl)}}}),addedFilterControl?(header.off("keyup","input").on("keyup","input",function(a){$(this).hasClass("date-filter-control-start")||(clearTimeout(timeoutId),timeoutId=setTimeout(function(){that.onColumnSearch(a)},that.options.searchTimeOut))}),header.off("change","select").on("change","select",function(a){clearTimeout(timeoutId),timeoutId=setTimeout(function(){that.onColumnSearch(a)},that.options.searchTimeOut)}),header.off("mouseup","input").on("mouseup","input",function(a){if(!$(this).hasClass("date-filter-control-start")){var b=$(this),c=b.val();if(""===c)return;setTimeout(function(){var c=b.val();""===c&&(clearTimeout(timeoutId),timeoutId=setTimeout(function(){that.onColumnSearch(a)},that.options.searchTimeOut))},1)}})):header.find(".filterControl").hide()},getDirectionOfSelectOptions=function(a){switch(a=void 0===a?"left":a.toLowerCase()){case"left":return"ltr";case"right":return"rtl";case"auto":return"auto";default:return"ltr"}},filterDataMethods={"var":function(a,b){var d,c=window[a];for(d in c)addOptionToSelectControl(b,d,c[d]);sortSelectControl(b)},url:function(a,b){$.ajax({url:a,dataType:"json",success:function(a){for(var c in a)addOptionToSelectControl(b,c,a[c]);sortSelectControl(b)}})},json:function(a,b){var d,c=JSON.parse(a);for(d in c)addOptionToSelectControl(b,d,c[d]);sortSelectControl(b)}},getFilterDataMethod=function(a,b){var d,c=Object.keys(a);for(d=0;d<c.length;d++)if(c[d]===b)return a[b];return null};$.extend($.fn.bootstrapTable.defaults,{filterControl:!1,onColumnSearch:function(){return!1},filterShowClear:!1,alignmentSelectControlOptions:void 0,filterTemplate:{input:function(a,b,c,d){return sprintf('<input class="form-control bootstrap-table-filter-control-%s" style="width: 100%; visibility: %s" placeholder="%s">',b,c,d)},select:function(a,b,c){return sprintf('<select class="form-control bootstrap-table-filter-control-%s" style="width: 100%; visibility: %s" dir="%s"></select>',b,c,getDirectionOfSelectOptions(a.options.alignmentSelectControlOptions))},datepicker:function(a,b,c){var f,g,h,i,j,k,l,d=!1,e=a.options.datepickerBetween;for(f in e)e[f].field===b&&(d=e[f].between);g={},e=a.columns;for(h in e)e[h].field===b&&(g=e[h].laydateOptions);return i=$(a.$el[0]).attr("id"),j=sprintf("<div readonly  onclick=\"Global.activeLaydatePicker(this,'"+i+"',"+g+')" class="bootstrap-laydate form-control date-filter-control date-filter-control-single bootstrap-table-filter-control-%s" style="width: 100%; visibility: %s"></div>',b,c),k=sprintf("<div readonly  onclick=\"Global.activeLaydatePicker(this,'"+i+"',"+g+')" class="bootstrap-laydate form-control date-filter-control date-filter-control-start bootstrap-table-filter-control-%s-start" style="width: 100%; visibility: %s"></div>',b,c),l=sprintf("<div readonly  onclick=\"Global.activeLaydatePicker(this,'"+i+"',"+g+')" class="bootstrap-laydate form-control date-filter-control date-filter-control-end bootstrap-table-filter-control-%s-end" style="width: 100%; margin-top: 2px; visibility: %s"></div>',b,c),d?k+l:j}},valuesFilterControl:[]}),$.extend($.fn.bootstrapTable.COLUMN_DEFAULTS,{filterControl:void 0,filterData:void 0,filterDatepickerOptions:void 0,filterStrictSearch:!1,filterStartsWithSearch:!1,filterControlPlaceholder:"",filterDatepickerBetween:!1}),$.extend($.fn.bootstrapTable.Constructor.EVENTS,{"column-search.bs.table":"onColumnSearch"}),$.extend($.fn.bootstrapTable.defaults.icons,{clear:"glyphicon-trash icon-clear"}),$.extend($.fn.bootstrapTable.locales,{formatClearFilters:function(){return"Clear Filters"}}),$.extend($.fn.bootstrapTable.defaults,$.fn.bootstrapTable.locales),BootstrapTable=$.fn.bootstrapTable.Constructor,_init=BootstrapTable.prototype.init,_initToolbar=BootstrapTable.prototype.initToolbar,_initHeader=BootstrapTable.prototype.initHeader,_initBody=BootstrapTable.prototype.initBody,_initSearch=BootstrapTable.prototype.initSearch,BootstrapTable.prototype.init=function(){if(this.options.filterControl){var a=this;Object.keys||objectKeys(),this.options.valuesFilterControl=[],this.$el.on("reset-view.bs.table",function(){a.options.height&&(a.$tableHeader.find("select").length>0||a.$tableHeader.find("input").length>0)}).on("post-header.bs.table",function(){setValues(a)}).on("post-body.bs.table",function(){a.options.height&&fixHeaderCSS(a)}).on("column-switch.bs.table",function(){setValues(a)})}_init.apply(this,Array.prototype.slice.apply(arguments))},BootstrapTable.prototype.initToolbar=function(){if(this.showToolbar=this.options.filterControl&&this.options.filterShowClear,_initToolbar.apply(this,Array.prototype.slice.apply(arguments)),this.options.filterControl&&this.options.filterShowClear){var a=this.$toolbar.find(">.btn-group"),b=a.find(".filter-show-clear");b.length||(b=$(['<button class="btn btn-default filter-show-clear" ',sprintf('type="button" title="%s">',this.options.formatClearFilters()),sprintf('<i class="%s %s"></i> ',this.options.iconsPrefix,this.options.icons.clear),"</button>"].join("")).appendTo(a),b.off("click").on("click",$.proxy(this.clearFilterControl,this)))}},BootstrapTable.prototype.initHeader=function(){_initHeader.apply(this,Array.prototype.slice.apply(arguments)),this.options.filterControl&&createControls(this,this.$header)},BootstrapTable.prototype.initBody=function(){_initBody.apply(this,Array.prototype.slice.apply(arguments)),initFilterSelectControls(this)},BootstrapTable.prototype.initSearch=function(){var a,b;_initSearch.apply(this,Array.prototype.slice.apply(arguments)),"server"!==this.options.sidePagination&&(a=this,b=$.isEmptyObject(this.filterColumnsPartial)?null:this.filterColumnsPartial,this.data=b?$.grep(this.data,function(c,d){var e,f,g,h;for(e in b)if(f=a.columns[$.fn.bootstrapTable.utils.getFieldIndex(a.columns,e)],g=b[e].toLowerCase(),h=c[e],f&&f.searchFormatter&&(h=$.fn.bootstrapTable.utils.calculateObjectValue(a.header,a.header.formatters[$.inArray(e,a.header.fields)],[h,c,d],h)),f.filterStrictSearch){if(-1===$.inArray(e,a.header.fields)||"string"!=typeof h&&"number"!=typeof h||h.toString().toLowerCase()!==g.toString().toLowerCase())return!1}else if(f.filterStartsWithSearch){if(-1===$.inArray(e,a.header.fields)||"string"!=typeof h&&"number"!=typeof h||0!==(h+"").toLowerCase().indexOf(g))return!1}else if(-1===$.inArray(e,a.header.fields)||"string"!=typeof h&&"number"!=typeof h||-1===(h+"").toLowerCase().indexOf(g))return!1;return!0}):this.data)},BootstrapTable.prototype.initColumnSearch=function(a){if(copyValues(this),a){this.filterColumnsPartial=a,this.updatePagination();for(var b in a)this.trigger("column-search",b,a[b])}},BootstrapTable.prototype.onColumnSearch=function(a){var b,c;$.inArray(a.keyCode,[37,38,39,40])>-1||(copyValues(this),b=$.trim($(a.currentTarget).val()),c=$(a.currentTarget).closest("[data-field]").data("field"),$.isEmptyObject(this.filterColumnsPartial)&&(this.filterColumnsPartial={}),b?this.filterColumnsPartial[c]=b:delete this.filterColumnsPartial[c],this.searchText+="randomText",this.options.pageNumber=1,this.onSearch(a),this.trigger("column-search",c,b))},BootstrapTable.prototype.clearFilterControl=function(){var a,b,c,d,e,f,g,h;if(this.options.filterControl&&this.options.filterShowClear){if(a=this,b=collectBootstrapCookies(),c=getCurrentHeader(a),d=c.closest("table"),e=c.find(getCurrentSearchControls(a)),f=a.$toolbar.find(".search input"),g=0,$.each(a.options.valuesFilterControl,function(a,b){b.value=""}),$(".bootstrap-laydate").text(""),setValues(a),!(e.length>0))return;this.filterColumnsPartial={},$(e[0]).trigger("INPUT"===e[0].tagName?"keyup":"change"),f.length>0&&a.resetSearch(),(a.options.sortName!==d.data("sortName")||a.options.sortOrder!==d.data("sortOrder"))&&(h=c.find(sprintf('[data-field="%s"]',$(e[0]).closest("table").data("sortName"))),h.length>0&&(a.onSort(d.data("sortName"),d.data("sortName")),$(h).find(".sortable").trigger("click"))),clearTimeout(g),g=setTimeout(function(){b&&b.length>0&&$.each(b,function(b,c){void 0!==a.deleteCookie&&a.deleteCookie(c)})},a.options.searchTimeOut)}}}(jQuery);